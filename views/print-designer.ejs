<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <title>Print Designer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #card-preview { background: #fff; position: relative; border: 2px solid #000; }
    .pd-field { position: absolute; cursor: move; left: 50%; transform: translateX(-50%); }
    .barcode-number, .qr-number { text-align: center; width: 100%; font-family: monospace; font-size: 12px; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">
  <%- include('partials/nav', { user: user }) %>

  <main class="flex-1 container mx-auto p-6">
    <h2 class="text-2xl font-bold mb-4 text-green-400">Print Designer</h2>
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Controls -->
      <div class="w-full max-w-xs space-y-4">
        <h3 class="font-semibold">Show / Hide & Position</h3>
        <% const fields = [
          { id: 'pd-name', label: 'Name', text: true },
          { id: 'pd-designation', label: 'Designation', text: true },
          { id: 'pd-category', label: 'Category', text: true },
          { id: 'pd-company', label: 'Company', text: true },
          { id: 'pd-mobile', label: 'Mobile', text: true },
          { id: 'pd-barcode', label: 'Barcode', text: false, scalable: true },
          { id: 'pd-qr', label: 'QR Code', text: false, scalable: true }
        ]; %>
        <% fields.forEach(f => { %>
          <div class="mb-2">
            <label>
              <input type="checkbox" class="pd-toggle" data-field="<%= f.id %>" checked>
              <%= f.label %>
            </label>
            <div class="flex gap-2 mt-1 items-center flex-wrap">
              <input type="number" class="pd-x w-14 p-1 rounded text-black" data-field="<%= f.id %>" placeholder="X" min="0">
              <input type="number" class="pd-y w-14 p-1 rounded text-black" data-field="<%= f.id %>" placeholder="Y" min="0">
              <% if (f.text) { %>
                <input type="number" class="pd-font w-14 p-1 rounded text-black" data-field="<%= f.id %>" placeholder="Font" min="8" max="60">
                <span class="text-xs">px</span>
                <select class="pd-align p-1 rounded text-black" data-field="<%= f.id %>">
                  <option value="left">L</option>
                  <option value="center">C</option>
                  <option value="right">R</option>
                </select>
              <% } %>
              <% if (f.scalable) { %>
                <input type="number" class="pd-scale w-16 p-1 rounded text-black" data-field="<%= f.id %>" placeholder="Scale" min="20" max="300">
                <span class="text-xs">px</span>
              <% } %>
            </div>
          </div>
        <% }) %>
        <div class="mb-2">
          <label class="block font-semibold">Badge Size</label>
          <select id="badge-size" class="w-full p-2 rounded text-black">
            <option value="350x220">4 x 2.5 inch (350x220px)</option>
            <option value="400x600">4 x 6 inch (400x600px)</option>
            <option value="300x400">3 x 4 inch (300x400px)</option>
            <option value="custom">Custom</option>
          </select>
          <div id="custom-size-inputs" class="flex gap-2 mt-2 hidden">
            <input type="number" id="custom-width" class="w-20 p-1 rounded text-black" placeholder="Width(px)" min="100">
            <input type="number" id="custom-height" class="w-20 p-1 rounded text-black" placeholder="Height(px)" min="100">
          </div>
        </div>
        <button id="pd-save" class="mt-4 w-full bg-green-600 hover:bg-green-700 py-2 rounded">Save Layout</button>
      </div>

      <!-- Preview -->
      <div>
        <div id="card-preview" class="mx-auto rounded shadow-md overflow-hidden" style="width:350px;height:220px;">
          <div id="pd-name" class="pd-field text-black font-bold" style="top:20px;font-size:20px;text-align:center;width:200px;">Name</div>
          <div id="pd-designation" class="pd-field text-black" style="top:60px;font-size:14px;text-align:center;width:200px;">Designation</div>
          <div id="pd-category" class="pd-field text-black" style="top:90px;font-size:14px;text-align:center;width:200px;">Category</div>
          <div id="pd-company" class="pd-field text-black" style="top:120px;font-size:14px;text-align:center;width:200px;">Company</div>
          <div id="pd-mobile" class="pd-field text-black" style="top:150px;font-size:14px;text-align:center;width:200px;">Mobile</div>
          <!-- Barcode -->
          <div id="pd-barcode" class="pd-field" style="top:180px;text-align:center;width:120px;">
            <img src="https://barcode.tec-it.com/barcode.ashx?data=BAR7C2D&code=Code128&translate-esc=false" alt="barcode" style="width:100%;height:40px;">
            <div class="barcode-number font-mono text-xs" style="width:100%;">BAR7C2D</div>
          </div>
          <!-- QR Code -->
          <div id="pd-qr" class="pd-field" style="top:180px;text-align:center;width:60px;">
            <img src="https://api.qrserver.com/v1/create-qr-code/?data=BAR7C2D&size=60x60" alt="qr" style="width:100%;height:60px;">
            <div class="qr-number font-mono text-xs" style="width:100%;">BAR7C2D</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <%- include('partials/footer') %>
  <script>
    window.savedLayout = <%- JSON.stringify(layout || {}) %>;
  </script>
  <script src="/js/designer.js"></script>
</body>
</html>